import{S as $,B as o,s as g}from"./index-191f4ffb.js";const M=["Вс.","Пн.","Вт.","Ср.","Чт.","Пт.","Сб."],T=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],b=["Пн.","Вт.","Ср.","Чт.","Пт.","Сб.","Вс."],p=["янв.","февр.","марта","апр.","мая","июня","июля","авг.","сент.","окт.","нояб.","дек."],S=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],I=["#208B9A","#FF7A00","#133AAC","#00C322","#FF1300","#7808A9","#D1006B","#F3FC01","#01B54F","#FFFFFF"],c=$("DateStore",{state(){return{year:new Date().getFullYear(),month:new Date().getMonth(),day:new Date().getDate()+1,oldDate:void 0}},getters:{getCorrectDate(){let e=new Date(this.year,this.month,this.day);return this.oldDate&&(this.oldDate.getFullYear()!=e.getFullYear()||this.oldDate.getMonth()!=e.getMonth())&&L().getFunerals(),this.oldDate=e,{year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),week:e.getDay()}},getUnCorrectDate(){return{year:this.year,month:this.month,day:this.day}},getTimeCode(){let e=new Date(this.year,this.month,this.day).getTime(),t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1).getTime(),s=new Date(t.getFullYear(),t.getMonth(),t.getDate()+2).getTime();return{now:e,today:r,tomorrow:i,aftertomorrow:s}},getDateShort(){let e=this.getCorrectDate;return`${M[e.week]} ${e.day} ${p[e.month]} ${e.year}`},getDateForSupabase(){let e=this.getCorrectDate;return`${e.year}-${h(e.month+1)}-${h(e.day)}`},getDateDay(){let e=this.getTimeCode,t=this.getCorrectDate;return e.now===e.today?" СЕГОДНЯ":e.now===e.tomorrow?" ЗАВТРА":e.now===e.aftertomorrow?" ПОСЛЕЗАВТРА":`: ${h(t.day)}/${h(t.month+1)}/${t.year}`},getDateForStatistic(){let e=this.getCorrectDate;return`${S[e.month]} ${e.year}`},getDateForEmail(){let e=this.getUnCorrectDate;e.month=e.month-1;let t=new Date(e.year,e.month,e.day);return e={year:t.getFullYear(),month:t.getMonth(),day:t.getDate()},`${S[e.month]} ${e.year}`},getFirstDayMonth(){let e=this.getCorrectDate;return`${e.year}-${h(e.month+1)}-01`},getLastDayMonth(){let e=this.getCorrectDate;return`${e.year}-${h(e.month+1)}-31`},getFirstDayThreeMonths(){let e=new Date(this.year,this.month-1,this.day);return`${e.getFullYear()}-${h(e.getMonth()+1)}-01`},getLastDayThreeMonths(){let e=new Date(this.year,this.month+1,this.day);return`${e.getFullYear()}-${h(e.getMonth()+1)}-31`}},actions:{setDateToday(){let e=new Date;this.year=e.getFullYear(),this.month=e.getMonth(),this.day=e.getDate()},setDateIncrement(e){this.day+=e},setDateByCalendarCell(e){this.year=e.year,this.month=e.month,this.day=e.day}}});function h(e){return e<10?`0${e}`:e}const L=$("FuneralsStore",{state(){return{funerals:[]}},getters:{getFuneralsForRead(){let e=c().getDateForSupabase;return this.funerals.filter(t=>t.date==e)},getFuneralsForEdit(e){return t=>e.funerals.find(r=>r.id==t)},getFuneralsForAllocation(){return this.getFuneralsForRead.filter(e=>e.templ==="false"||e.templ===!1)},getFuneralsForPhone(){return this.getFuneralsForRead.filter(e=>e.phoneLocation==="false"||e.phoneLocation===!1||e.phoneTempl===!1)},getFuneralsForStatistic(){return this.funerals.filter(e=>e.templ!=="false"&&e.date>=c().getFirstDayMonth&&e.date<=c().getLastDayMonth)}},actions:{async getFunerals(){let e=f("FuneralsPostArray"),t=f("FuneralsPutArray"),r=f("FuneralsDeleteArray");if(o().status){let i=!!e;if(e&&r){let n=[];r.forEach(l=>{let y=e.findIndex(A=>A.id===l);y!==-1&&(e.splice(y,1),n.push(l))}),r=r.filter(l=>!n.includes(l)),r[0]||(window.localStorage.removeItem("FuneralsDeleteArray"),r=!1),e[0]||(window.localStorage.removeItem("FuneralsPostArray"),e=!1)}if(!e&&i&&t&&(window.localStorage.removeItem("FuneralsPutArray"),t=!1),e&&t){let n=[];t.forEach(l=>{e.forEach(y=>{+l.id==+y.id&&(n.push(l),Object.keys(l.put).forEach(P=>{y[P]=l.put[P]}))})}),t=t.filter(l=>!n.includes(l)),t[0]||(window.localStorage.removeItem("FuneralsPutArray"),t=!1)}e&&e.forEach(n=>{delete n.id});let s=!!e,u=!!r,a=!!t,d=!1,D=!1,m=!1;e&&await g.from("FUNERAL").insert(e).then(()=>{window.localStorage.removeItem("FuneralsPostArray"),d=!0,w(s,u,a,d,D,m)&&this.getFunerals()}),r&&await g.from("FUNERAL").delete().in("id",r).then(()=>{window.localStorage.removeItem("FuneralsDeleteArray"),D=!0,w(s,u,a,d,D,m)&&this.getFunerals()}),t&&t.forEach(async(n,l)=>{await g.from("FUNERAL").update(n.put).eq("id",n.id).then(()=>{t.length-1==l&&(window.localStorage.removeItem("FuneralsPutArray"),m=!0,w(s,u,a,d,D,m)&&this.getFunerals())})}),await g.from("FUNERAL").select("*").gte("date",c().getFirstDayThreeMonths).lte("date",c().getLastDayThreeMonths).order("locationTempl",{ascending:!0}).order("locationCemetery",{ascending:!0}).order("locationAddress",{ascending:!0}).order("time",{ascending:!0}).then(n=>{this.funerals=n.data,F("FuneralsBigData",n.data)})}else{let i=f("FuneralsBigData");e&&e.forEach(s=>{i.push(s)}),r&&r.forEach(s=>{let u=i.findIndex(a=>a.id===s);u!==-1&&i.splice(u,1)}),t&&t.forEach(s=>{i.forEach(u=>{+s.id==+u.id&&Object.keys(s.put).forEach(d=>{u[d]=s.put[d]})})}),this.funerals=i}},async postFunerals(e){if(o().status)await g.from("FUNERAL").insert(e).then(t=>{t.error?o().addPush("Не удалось добавить отпевание","red",3500):o().addPush("Отпевание добавлено","basic",1500)});else{if(e.id=new Date().getTime(),window.localStorage.getItem("FuneralsPostArray")){let t=f("FuneralsPostArray");t.push(e),F("FuneralsPostArray",t)}else F("FuneralsPostArray",[e]);o().addPush("Отпевание добавлено offline","basic",1500)}window.navigator.vibrate([100,50,100]),this.getFunerals()},async putFunerals(e,t){if(o().status)await g.from("FUNERAL").update(e).eq("id",t).then(r=>{r.error?o().addPush("Не удалось изменить отпевание","red",3500):o().addPush("Отпевание изменено","basic",1500)});else{if(window.localStorage.getItem("FuneralsPutArray")){let r=f("FuneralsPutArray");r.push({id:t,put:e}),F("FuneralsPutArray",r)}else F("FuneralsPutArray",[{id:t,put:e}]);o().addPush("Отпевание изменено offline","basic",1500)}window.navigator.vibrate(200),this.getFunerals()},async deleteFunerals(e){if(o().status)await g.from("FUNERAL").delete().eq("id",e).then(t=>{t.error?o().addPush("Не удалось удалить отпевание","red",3500):o().addPush("Отпевание удалено","basic",1500)});else{if(window.localStorage.getItem("FuneralsDeleteArray")){let t=f("FuneralsDeleteArray");t.push(e),F("FuneralsDeleteArray",t)}else F("FuneralsDeleteArray",[e]);o().addPush("Отпевание удалено offline","basic",1500)}window.navigator.vibrate([500,100,50]),this.getFunerals()}}});function f(e){return JSON.parse(window.localStorage.getItem(e))}function F(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function w(e,t,r,i,s,u){let a=0;return a=e?a+1:a+2,a=i?a+1:a,a=t?a+1:a+2,a=s?a+1:a,a=r?a+1:a+2,a=u?a+1:a,a==6?(o().addPush("Отпевания синхронизированны","basic",1500),!0):!1}export{b as D,S as M,c as a,T as b,I as c,L as u};
