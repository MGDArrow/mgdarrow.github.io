import{A as b,a as x,b as S,c as V}from"./AddPayment-fed0a943.js";import{T as I}from"./TheButton-16422633.js";import{T as w}from"./TheInputText-a9d655e2.js";import{b as B,a as f,u as g}from"./FuneralsStore-79f762a7.js";import{y,_ as T,o as l,c as r,F as N,r as L,n as M,t as u,A as _,a as c,B as E,q as m,E as v,v as d}from"./index-54c2cc17.js";import"./ServicesStore-19143761.js";import"./CemeterysStore-1c03515a.js";import"./TemplsStore-11f6e3ad.js";const U={name:"AddInfo",props:["time","templ"],data(){return{celebrations:B}},computed:{...y(f,["getCorrectDate"]),...y(g,["getFuneralsForRead"]),getFuneralsInTempl(){let t=this.getFuneralsForRead,e=[];return t.forEach(s=>{if(s.locationTempl==this.$props.templ){let i=this.timeOverlap(s.time,this.$props.time);e.push({time:s.time,overlap:i})}}),e},getMessageStdSun(){let t=this.getCorrectDate.week;return!!(t===6&this.$props.time>="13:30"||t===0&&this.$props.time<="10:00")},getCelebration(){let t=this.getCorrectDate.day,e=this.getCorrectDate.month+1,s=!1;return this.celebrations.forEach(i=>{i.month===e&&i.day===t&&(s=`Сегодня ${i.name}`)}),s}},methods:{timeOverlap(t,e){t=t.split(":"),e=e.split(":");let s=new Date(2023,1,1,t[0],t[1],0),i=new Date(2023,1,1,e[0],e[1],0);return Math.abs((i-s)/6e4)<15}}},q={class:"add-info"},G={key:0,class:"info__funerals"},O=c("div",{class:"info__funerals--name"},"В этом храме есть отпевания на:",-1),P={key:1,class:"info__funerals--name"},R={key:2,class:"info__funerals--name"};function z(t,e,s,i,o,a){return l(),r("div",q,[a.getFuneralsInTempl.length&&s.templ?(l(),r("div",G,[O,(l(!0),r(N,null,L(a.getFuneralsInTempl,p=>(l(),r("div",{class:M(["info__funerals--times",{"info-red":p.overlap}]),key:p.id},u(p.time),3))),128))])):_("",!0),a.getMessageStdSun?(l(),r("div",P," Возможно накладка на службу? ")):_("",!0),a.getCelebration?(l(),r("div",R,u(a.getCelebration),1)):_("",!0)])}const j=T(U,[["render",z]]);const H={components:{AddServices:b,TheButton:I,AddTime:x,AddTempl:S,TheInputText:w,AddPayment:V,AddInfo:j},name:"AppFunAdd",data(){return{service:"",time:"",locationTempl:"",locationCemetery:"",locationAddress:"",surname:"",comment:"",payment:!0}},computed:{getDate(){return`Добавить на${f().getDateDay}`}},methods:{addFuneral(){let t=E().user.user.email;if(t){let e=f().getDateForSupabase,s=this.locationTempl&&this.locationTempl!=="Свято-Пантелеимоновский храм (ГБ №2)"?this.locationTempl:!1,i=this.locationTempl==="Свято-Пантелеимоновский храм (ГБ №2)"?!1:null,o=!1;(this.locationTempl||this.locationCemetery||this.locationAddress)&&g().postFunerals({service:this.service.name,date:e,time:this.time,locationTempl:this.locationTempl,locationCemetery:this.locationCemetery,locationAddress:this.locationAddress,surname:this.surname,comment:this.comment,payment:this.payment,templ:s,phoneLocation:i,phoneTempl:o,idUserName:t}).then(this.clearForm())}else this.$router.replace({path:"/login"})},getLocation(t){this.locationTempl=t.type==="templ"?t.location:"",this.locationCemetery=t.type==="cemetery"?t.location:"",this.locationAddress=t.type==="address"?t.location:""},clearForm(){this.time="",this.locationTempl="",this.locationCemetery="",this.locationAddress="",this.surname="",this.comment="",this.payment=!0}}},J={class:"app__add"},K={key:2,class:"add-funeral"},Q={class:"add__time-service"};function W(t,e,s,i,o,a){const p=m("add-services"),A=m("add-time"),C=m("add-payment"),F=m("add-templ"),h=m("the-input-text"),k=m("add-info"),D=m("the-button");return l(),r("div",J,[c("h1",null,u(a.getDate),1),o.service?o.time?(l(),r("div",K,[c("div",Q,[c("div",{class:"add__time-block",onClick:e[2]||(e[2]=n=>o.time="")},u(o.time),1),c("div",{class:"add__service-block",onClick:e[3]||(e[3]=n=>o.service="")},u(o.service.name),1),d(C,{class:"add__payment-block",payment:o.payment,onPay:e[4]||(e[4]=n=>o.payment=!o.payment)},null,8,["payment"])]),d(F,{onLocation:e[5]||(e[5]=n=>a.getLocation(n))}),d(h,{label:"Фамилия",type:"text",modelValue:o.surname,"onUpdate:modelValue":e[6]||(e[6]=n=>o.surname=n),modelModifiers:{trim:!0}},null,8,["modelValue"]),d(h,{label:"Комментарий",type:"text",modelValue:o.comment,"onUpdate:modelValue":e[7]||(e[7]=n=>o.comment=n),modelModifiers:{trim:!0}},null,8,["modelValue"]),d(k,{templ:o.locationTempl,time:o.time},null,8,["templ","time"]),d(D,{text:"Добавить",onClick:e[8]||(e[8]=n=>a.addFuneral())})])):(l(),v(A,{key:1,onGetTime:e[1]||(e[1]=n=>o.time=n)})):(l(),v(p,{key:0,onGetService:e[0]||(e[0]=n=>o.service=n)}))])}const ne=T(H,[["render",W]]);export{ne as default};
