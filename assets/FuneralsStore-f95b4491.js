import{R as S,B as w,s as d}from"./index-f2cf6056.js";const M=["Вс.","Пн.","Вт.","Ср.","Чт.","Пт.","Сб."],T=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],I=["Пн.","Вт.","Ср.","Чт.","Пт.","Сб.","Вс."],$=["янв.","февр.","марта","апр.","мая","июня","июля","авг.","сент.","окт.","нояб.","дек."],p=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],v=["#208B9A","#FF7A00","#133AAC","#00C322","#FF1300","#7808A9","#D1006B","#F3FC01","#01B54F","#FFFFFF"],y=S("DateStore",{state(){return{year:new Date().getFullYear(),month:new Date().getMonth(),day:new Date().getDate()+1,oldDate:void 0}},getters:{getCorrectDate(){let e=new Date(this.year,this.month,this.day);return this.oldDate&&(this.oldDate.getFullYear()!=e.getFullYear()||this.oldDate.getMonth()!=e.getMonth())&&L().getFunerals(),this.oldDate=e,{year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),week:e.getDay()}},getUnCorrectDate(){return{year:this.year,month:this.month,day:this.day}},getTimeCode(){let e=new Date(this.year,this.month,this.day).getTime(),t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1).getTime(),s=new Date(t.getFullYear(),t.getMonth(),t.getDate()+2).getTime();return{now:e,today:r,tomorrow:l,aftertomorrow:s}},getDateShort(){let e=this.getCorrectDate;return`${M[e.week]} ${e.day} ${$[e.month]} ${e.year}`},getDateForSupabase(){let e=this.getCorrectDate;return`${e.year}-${u(e.month+1)}-${u(e.day)}`},getDateDay(){let e=this.getTimeCode,t=this.getCorrectDate;return e.now===e.today?" СЕГОДНЯ":e.now===e.tomorrow?" ЗАВТРА":e.now===e.aftertomorrow?" ПОСЛЕЗАВТРА":`: ${u(t.day)}/${u(t.month+1)}/${t.year}`},getDateForStatistic(){let e=this.getCorrectDate;return`${p[e.month]} ${e.year}`},getFirstDayMonth(){let e=this.getCorrectDate;return`${e.year}-${u(e.month+1)}-01`},getLastDayMonth(){let e=this.getCorrectDate;return`${e.year}-${u(e.month+1)}-31`},getFirstDayThreeMonths(){let e=new Date(this.year,this.month-1,this.day);return`${e.getFullYear()}-${u(e.getMonth()+1)}-01`},getLastDayThreeMonths(){let e=new Date(this.year,this.month+1,this.day);return`${e.getFullYear()}-${u(e.getMonth()+1)}-31`}},actions:{setDateToday(){let e=new Date;this.year=e.getFullYear(),this.month=e.getMonth(),this.day=e.getDate()},setDateIncrement(e){this.day+=e},setDateByCalendarCell(e){this.year=e.year,this.month=e.month,this.day=e.day}}});function u(e){return e<10?`0${e}`:e}const L=S("FuneralsStore",{state(){return{funerals:[]}},getters:{getFuneralsForRead(){let e=y().getDateForSupabase;return this.funerals.filter(t=>t.date==e)},getFuneralsForEdit(e){return t=>e.funerals.find(r=>r.id==t)},getFuneralsForAllocation(){return this.getFuneralsForRead.filter(e=>e.templ==="false"||e.templ===!1)},getFuneralsForPhone(){return this.getFuneralsForRead.filter(e=>e.phoneLocation==="false"||e.phoneLocation===!1||e.phoneTempl===!1)},getFuneralsForStatistic(){return this.funerals.filter(e=>e.templ!=="false"&&e.date>=y().getFirstDayMonth&&e.date<=y().getLastDayMonth)}},actions:{async getFunerals(){let e=g("FuneralsPostArray"),t=g("FuneralsPutArray"),r=g("FuneralsDeleteArray");if(w().status){let l=!!e;if(e&&r){let o=[];r.forEach(n=>{let F=e.findIndex(A=>A.id===n);F!==-1&&(e.splice(F,1),o.push(n))}),r=r.filter(n=>!o.includes(n)),r[0]||(window.localStorage.removeItem("FuneralsDeleteArray"),r=!1),e[0]||(window.localStorage.removeItem("FuneralsPostArray"),e=!1)}if(!e&&l&&t&&(window.localStorage.removeItem("FuneralsPutArray"),t=!1),e&&t){let o=[];t.forEach(n=>{e.forEach(F=>{+n.id==+F.id&&(o.push(n),Object.keys(n.put).forEach(P=>{F[P]=n.put[P]}))})}),t=t.filter(n=>!o.includes(n)),t[0]||(window.localStorage.removeItem("FuneralsPutArray"),t=!1)}e&&e.forEach(o=>{delete o.id});//!todo Сделать добавление удаление и изменение оставшихся
let s=!!e,i=!!r,a=!!t,h=!1,c=!1,D=!1;e&&await d.from("FUNERAL").insert(e).then(()=>{window.localStorage.removeItem("FuneralsPostArray"),h=!0,m(s,i,a,h,c,D)&&this.getFunerals()}),r&&await d.from("FUNERAL").delete().in("id",r).then(()=>{window.localStorage.removeItem("FuneralsDeleteArray"),c=!0,m(s,i,a,h,c,D)&&this.getFunerals()}),t&&t.forEach(async(o,n)=>{await d.from("FUNERAL").update(o.put).eq("id",o.id).then(()=>{t.length-1==n&&(window.localStorage.removeItem("FuneralsPutArray"),D=!0,m(s,i,a,h,c,D)&&this.getFunerals())})}),await d.from("FUNERAL").select("*").gte("date",y().getFirstDayThreeMonths).lte("date",y().getLastDayThreeMonths).order("locationTempl",{ascending:!0}).order("locationCemetery",{ascending:!0}).order("locationAddress",{ascending:!0}).order("time",{ascending:!0}).then(o=>{this.funerals=o.data,f("FuneralsBigData",o.data)})}else{let l=g("FuneralsBigData");e&&e.forEach(s=>{l.push(s)}),r&&r.forEach(s=>{let i=l.findIndex(a=>a.id===s);i!==-1&&l.splice(i,1)}),t&&t.forEach(s=>{l.forEach(i=>{+s.id==+i.id&&Object.keys(s.put).forEach(h=>{i[h]=s.put[h]})})}),this.funerals=l}},async postFunerals(e){if(w().status)await d.from("FUNERAL").insert(e);else if(e.id=new Date().getTime(),window.localStorage.getItem("FuneralsPostArray")){let t=g("FuneralsPostArray");t.push(e),f("FuneralsPostArray",t)}else f("FuneralsPostArray",[e]);window.navigator.vibrate([100,50,100]),this.getFunerals()},async putFunerals(e,t){if(w().status)await d.from("FUNERAL").update(e).eq("id",t);else if(window.localStorage.getItem("FuneralsPutArray")){let r=g("FuneralsPutArray");r.push({id:t,put:e}),f("FuneralsPutArray",r)}else f("FuneralsPutArray",[{id:t,put:e}]);window.navigator.vibrate(200),this.getFunerals()},async deleteFunerals(e){if(w().status)await d.from("FUNERAL").delete().eq("id",e);else if(window.localStorage.getItem("FuneralsDeleteArray")){let t=g("FuneralsDeleteArray");t.push(e),f("FuneralsDeleteArray",t)}else f("FuneralsDeleteArray",[e]);window.navigator.vibrate([500,100,50]),this.getFunerals()}}});function g(e){return JSON.parse(window.localStorage.getItem(e))}function f(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function m(e,t,r,l,s,i){let a=0;return a=e?a+1:a+2,a=l?a+1:a,a=t?a+1:a+2,a=s?a+1:a,a=r?a+1:a+2,a=i?a+1:a,a==6}export{I as D,p as M,y as a,T as b,v as c,L as u};
